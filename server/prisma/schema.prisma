generator client {
  provider = "prisma-client-js"
  previewFeatures = ["referentialActions"]
}

generator dbml {
  provider = "prisma-dbml-generator"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_DATABASE_URL")
}

model Session {
	id 				Int 		@id	@default(autoincrement())
	userId			Int
	token 			String
	expiresAt		DateTime
	data			String?
	createdAt		DateTime 	@default(now())
	updatedAt		DateTime 	@updatedAt
	user			User	 	@relation(fields: [userId], references: [id])

	@@index([expiresAt])
}

model Team {
	id				Int			@id @default(autoincrement())
	name 			String
	description		String?
	startDate		DateTime	
	endDate			DateTime	
	status			String		@default("Doing")
	picture 		String		
	numOfMember		Int?		@default(0)
	members			Member[]	

}

model Member {
	user			User 		@relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
	team			Team		@relation(fields: [teamId], references: [id], onDelete: Cascade, onUpdate: Cascade)
	isOwner			Boolean		@default(false)
	userId			Int
	teamId 			Int
 	joinedAt		DateTime @default(now())
 	assignedBy 		String

	@@unique([userId, teamId])
}

model User {
	id				Int			@id @default(autoincrement())
	name			String
	email			String		@unique
	createAt 		DateTime 	@default(now())
	picture			String?	
	updateAt		DateTime 	@updatedAt
	isAdmin			Boolean	 	@default(false)
	status 			String		@default("NotInitiated")
	session			Session?
	members			Member[]
	profile			Profile?

 	 @@index([email])
}

enum UserState {
	NOTINITIALTED
	INITIALTED
}

model Profile {
  id   				Int		 	@id @default(autoincrement())
  User 				User		@relation(fields: [userId], references: [id])
  userId			Int
}